{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# This is to move photos to sorted folders"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "from time import strptime\n",
    "import shutil\n",
    "import os\n",
    "from PIL import Image\n",
    "import calendar\n",
    "import time\n",
    "import datetime\n",
    "pics_format=['.jpeg','.jpg','.png','.gif','.tiff','.psd','.raw','.nef','.tif']\n",
    "video_file_extensions = [\n",
    "'.264', '.3g2', '.3gp', '.3gp2', '.3gpp', '.3gpp2', '.3mm', '.3p2', '.60d', '.787', '.89', '.aaf', '.aec', '.aep', '.aepx',\n",
    "'.aet', '.aetx', '.ajp', '.ale', '.am', '.amc', '.amv', '.amx', '.anim', '.aqt', '.arcut', '.arf', '.asf', '.asx', '.avb',\n",
    "'.avc', '.avd', '.avi', '.avp', '.avs', '.avs', '.avv', '.axm', '.bdm', '.bdmv', '.bdt2', '.bdt3', '.bik', '.bin', '.bix',\n",
    "'.bmk', '.bnp', '.box', '.bs4', '.bsf', '.bvr', '.byu', '.camproj', '.camrec', '.camv', '.ced', '.cel', '.cine', '.cip',\n",
    "'.clpi', '.cmmp', '.cmmtpl', '.cmproj', '.cmrec', '.cpi', '.cst', '.cvc', '.cx3', '.d2v', '.d3v', '.dat', '.dav', '.dce',\n",
    "'.dck', '.dcr', '.dcr', '.ddat', '.dif', '.dir', '.divx', '.dlx', '.dmb', '.dmsd', '.dmsd3d', '.dmsm', '.dmsm3d', '.dmss',\n",
    "'.dmx', '.dnc', '.dpa', '.dpg', '.dream', '.dsy', '.dv', '.dv-avi', '.dv4', '.dvdmedia', '.dvr', '.dvr-ms', '.dvx', '.dxr',\n",
    "'.dzm', '.dzp', '.dzt', '.edl', '.evo', '.eye', '.ezt', '.f4p', '.f4v', '.fbr', '.fbr', '.fbz', '.fcp', '.fcproject',\n",
    "'.ffd', '.flc', '.flh', '.fli', '.flv', '.flx', '.gfp', '.gl', '.gom', '.grasp', '.gts', '.gvi', '.gvp', '.h264', '.hdmov',\n",
    "'.hkm', '.ifo', '.imovieproj', '.imovieproject', '.ircp', '.irf', '.ism', '.ismc', '.ismv', '.iva', '.ivf', '.ivr', '.ivs',\n",
    "'.izz', '.izzy', '.jss', '.jts', '.jtv', '.k3g', '.kmv', '.ktn', '.lrec', '.lsf', '.lsx', '.m15', '.m1pg', '.m1v', '.m21',\n",
    "'.m21', '.m2a', '.m2p', '.m2t', '.m2ts', '.m2v', '.m4e', '.m4u', '.m4v', '.m75', '.mani', '.meta', '.mgv', '.mj2', '.mjp',\n",
    "'.mjpg', '.mk3d', '.mkv', '.mmv', '.mnv', '.mob', '.mod', '.modd', '.moff', '.moi', '.moov', '.mov', '.movie', '.mp21',\n",
    "'.mp21', '.mp2v', '.mp4', '.mp4v', '.mpe', '.mpeg', '.mpeg1', '.mpeg4', '.mpf', '.mpg', '.mpg2', '.mpgindex', '.mpl',\n",
    "'.mpl', '.mpls', '.mpsub', '.mpv', '.mpv2', '.mqv', '.msdvd', '.mse', '.msh', '.mswmm', '.mts', '.mtv', '.mvb', '.mvc',\n",
    "'.mvd', '.mve', '.mvex', '.mvp', '.mvp', '.mvy', '.mxf', '.mxv', '.mys', '.ncor', '.nsv', '.nut', '.nuv', '.nvc', '.ogm',\n",
    "'.ogv', '.ogx', '.osp', '.otrkey', '.pac', '.par', '.pds', '.pgi', '.photoshow', '.piv', '.pjs', '.playlist', '.plproj',\n",
    "'.pmf', '.pmv', '.pns', '.ppj', '.prel', '.pro', '.prproj', '.prtl', '.psb', '.psh', '.pssd', '.pva', '.pvr', '.pxv',\n",
    "'.qt', '.qtch', '.qtindex', '.qtl', '.qtm', '.qtz', '.r3d', '.rcd', '.rcproject', '.rdb', '.rec', '.rm', '.rmd', '.rmd',\n",
    "'.rmp', '.rms', '.rmv', '.rmvb', '.roq', '.rp', '.rsx', '.rts', '.rts', '.rum', '.rv', '.rvid', '.rvl', '.sbk', '.sbt',\n",
    "'.scc', '.scm', '.scm', '.scn', '.screenflow', '.sec', '.sedprj', '.seq', '.sfd', '.sfvidcap', '.siv', '.smi', '.smi',\n",
    "'.smil', '.smk', '.sml', '.smv', '.spl', '.sqz', '.srt', '.ssf', '.ssm', '.stl', '.str', '.stx', '.svi', '.swf', '.swi',\n",
    "'.swt', '.tda3mt', '.tdx', '.thp', '.tivo', '.tix', '.tod', '.tp', '.tp0', '.tpd', '.tpr', '.trp', '.ts', '.tsp', '.ttxt',\n",
    "'.tvs', '.usf', '.usm', '.vc1', '.vcpf', '.vcr', '.vcv', '.vdo', '.vdr', '.vdx', '.veg','.vem', '.vep', '.vf', '.vft',\n",
    "'.vfw', '.vfz', '.vgz', '.vid', '.video', '.viewlet', '.viv', '.vivo', '.vlab', '.vob', '.vp3', '.vp6', '.vp7', '.vpj',\n",
    "'.vro', '.vs4', '.vse', '.vsp', '.w32', '.wcp', '.webm', '.wlmp', '.wm', '.wmd', '.wmmp', '.wmv', '.wmx', '.wot', '.wp3',\n",
    "'.wpl', '.wtv', '.wve', '.wvx', '.xej', '.xel', '.xesc', '.xfl', '.xlmv', '.xmv', '.xvid', '.y4m', '.yog', '.yuv', '.zeg',\n",
    "'.zm1', '.zm2', '.zm3', '.zmv'  ]\n",
    "def get_taken_time(path,cur_photo):\n",
    "    try:\n",
    "        dt= Image.open(path)._getexif()[36867]\n",
    "    except:\n",
    "        try:\n",
    "            dt='0'\n",
    "        except:\n",
    "            os.replace(path,tgt+\"\\\\excluded\\\\\"+cur_photo)\n",
    "            dt = ''\n",
    "    return dt\n",
    "#  dates\n",
    "def sort_photos_by_date(src,file_name, tgt,min_size):\n",
    "#  for file in os.listdir(src):\n",
    "    cur_photo = file_name\n",
    "#     print(cur_photo)\n",
    "    date_time = get_taken_time(src + '\\\\' + cur_photo, cur_photo)\n",
    "    if not date_time == '':\n",
    "        if not date_time == '0':\n",
    "            year_taken = date_time[0:4:]\n",
    "            month_taken = date_time[5:7]\n",
    "            mn = month_taken\n",
    "            month_taken = calendar.month_name[int(month_taken)]\n",
    "        else:\n",
    "            dt = time.ctime(os.path.getmtime(src + '\\\\'+ cur_photo))\n",
    "            month_taken1 = dt[4:7:]\n",
    "            month_taken = datetime.datetime.strptime(month_taken1,'%b').strftime('%B')\n",
    "            year_taken = dt[20::]\n",
    "            mn = strptime(month_taken1, '%b').tm_mon\n",
    "            if mn < 10:\n",
    "                mn = '0' + str(mn)\n",
    "            mn = str(mn)\n",
    "        file_stats = os.stat(src + '\\\\'+ cur_photo)\n",
    "        f_size=file_stats.st_size / (1024 )\n",
    "        filename, file_extension = os.path.splitext(src + '\\\\'+ cur_photo)\n",
    "        file_extension=file_extension.lower()\n",
    "        extension='Others'\n",
    "        if file_extension in pics_format:\n",
    "            extension='Photos'\n",
    "        elif file_extension in  video_file_extensions:\n",
    "            extension='Videos'\n",
    "        if f_size>min_size :\n",
    "            if os.path.isdir(tgt + '\\\\' + year_taken + '\\\\' + mn + '_'+ month_taken+'\\\\'+extension):\n",
    "                os.replace(src + '\\\\' + cur_photo, tgt + '\\\\'+ year_taken + '\\\\' + mn + '_' + month_taken+'\\\\'+extension +'\\\\'+ cur_photo)\n",
    "            else:\n",
    "                os.makedirs(tgt + '\\\\' + year_taken + '\\\\' + mn + '_'+ month_taken+'\\\\'+extension)\n",
    "                os.replace(src + '\\\\' + cur_photo, tgt + '\\\\'+ year_taken + '\\\\' + mn + '_' + month_taken+'\\\\'+extension +'\\\\'+ cur_photo)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "scrolled": false
   },
   "outputs": [],
   "source": [
    "source_folder = r'E:\Aradhya\Personal",
    "tgt = r\"E:\Aradhya\Personal\My Pictures",
    "min_size = 400\n",
    "for subdir, dirs, files in os.walk(source_folder):\n",
    "        src_path=os.path.join(subdir)\n",
    "        for file in files:\n",
    "            file_name=file\n",
    "            sort_photos_by_date(src_path,file_name,tgt,min_size)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
